generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  TEACHER
  PARENT
  LEARNER
}

model User {
  id        String   @id @default(cuid())
  email     String?  @unique
  username  String   @unique
  password  String
  role      Role
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  profile        Profile?
  learners       Learner[] @relation("GuardianLearners")
  learnerProfile Learner?
}

model Profile {
  id        String   @id @default(cuid())
  userId    String   @unique
  firstName String
  lastName  String
  phone     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
}

model Learner {
  id          String   @id @default(cuid())
  userId      String   @unique
  guardianId  String
  firstName   String
  lastName    String
  dateOfBirth DateTime
  gradeLevel  Int
  actualLevel Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user     User   @relation(fields: [userId], references: [id])
  guardian User   @relation("GuardianLearners", fields: [guardianId], references: [id])

  diagnoses   Diagnosis[]
  assessments Assessment[]
  learningModel PersonalizedModel?
}

model Diagnosis {
  id          String   @id @default(cuid())
  learnerId   String
  description String
  createdAt   DateTime @default(now())

  learner Learner @relation(fields: [learnerId], references: [id])
}

model Assessment {
  id          String   @id @default(cuid())
  learnerId   String
  subject     String
  score       Int
  takenAt     DateTime @default(now())

  learner Learner @relation(fields: [learnerId], references: [id])
}

model PersonalizedModel {
  id          String   @id @default(cuid())
  learnerId   String   @unique
  summary     String
  updatedAt   DateTime @updatedAt

  learner Learner @relation(fields: [learnerId], references: [id])
}
